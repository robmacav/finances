
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes Legisla√ß√£o</title>
    <%= javascript_include_tag "detail-script", type: "module" %>
</head>
<body>
    <!-- Cabe√ßalho da p√°gina de detalhes -->
    <header class="detail-header">
        <div class="detail-header-content">
            <button class="back-btn" onclick="history.back()">
                ‚Üê Voltar
            </button>
            <div class="header-actions">
                <button class="share-btn">
                    üì§ Compartilhar
                </button>
            </div>
        </div>
    </header>

    <div class="detail-container">
        <!-- Informa√ß√µes do documento -->
        <section class="document-info">
            <div class="document-meta">
                <span class="document-type">üìÑ Decreto ‚Ä¢ D 30535/2025</span>
                <span class="publish-date">üìÖ Publicado 17/04/2025</span>
            </div>
            <p class="document-description">
                Disciplina a requisi√ß√£o de informa√ß√µes referentes a opera√ß√µes realizadas por usu√°rios de servi√ßos de 
                institui√ß√µes financeiras, nos termos da Lei Complementar 105/2001.
            </p>
        </section>

        <div class="content-layout">
            <!-- Barra lateral com sum√°rio -->
            <aside class="summary-sidebar">
                

                <div class="annexes-section">
                    <h3>Anexos</h3>
                    <ul class="annex-list">
                       <p>Carregando...</p>
                    </ul>
                </div>

                <script>
                
              async function carregarAnexos(leiId) {
  const container = document.querySelector(".annexes-section .annex-list");

  if (!container) return;

  try {
    const response = await fetch(`/link_arquivo/${leiId}`);
    const data = await response.json();

    // Limpa a lista existente
    container.innerHTML = "";

    if (!data.resultados || data.resultados.length === 0) {
      container.innerHTML = `<li class="annex-item">Nenhum anexo dispon√≠vel.</li>`;
      return;
    }

    data.resultados.forEach(arquivo => {
      const li = document.createElement("li");
      li.className = "annex-item";

      const a = document.createElement("a");
      a.href = `https://legislacao.sefin.ro.gov.br/Download?arquivo=${encodeURIComponent(arquivo.nomeservidor)}&nome=${encodeURIComponent(arquivo.nome)}`;
      a.className = "annex-link";
      a.textContent = `${arquivo.nome}`;

      li.appendChild(a);
      container.appendChild(li);
    });

  } catch (error) {
    console.error("Erro ao carregar anexos:", error);
    container.innerHTML = `<li class="annex-item">N√£o foi poss√≠vel carregar os anexos.</li>`;
  }
}

// Captura o par√¢metro "lei" da URL
const params = new URLSearchParams(window.location.search);
const lei = params.get("lei");

if (lei) {
  carregarAnexos(lei);
}
                
                </script>


            </aside>

            <!-- Conte√∫do principal -->
            <main class="document-content">
                <section class="official-text" id="official-text">
    <h2>Texto oficial</h2>
    <p>Carregando...</p>
    <!-- O conte√∫do ser√° substitu√≠do aqui -->
  </section>
</main>

<script>
async function carregarLei(id) {
  try {
    const response = await fetch(`pesquisar_detalhe_lei/${id}`);
    const data = await response.json();

    // Atualiza a se√ß√£o do texto oficial
    document.getElementById("official-text").innerHTML = `
      <h2>Texto oficial</h2>
      ${data.texto_html}
    `;

    // Atualiza o identificador e tipo do documento
    const documentTypeSpan = document.querySelector(".document-type");
    if (documentTypeSpan) {
      // Exemplo: üìÑ Decreto ‚Ä¢ D 30535/2025
      documentTypeSpan.innerHTML  = `üìÑ ${data.tipo || "Documento"} ‚Ä¢ ${data.identificador}`;
    }

    // Atualiza a data de publica√ß√£o
    const publishDateSpan = document.querySelector(".publish-date");
    if (publishDateSpan) {
      publishDateSpan.innerHTML  = `üìÖ Publicado ${data.publicado_em || ""}`;
    }

    // Atualiza a descri√ß√£o do documento
    const descriptionP = document.querySelector(".document-description");
    if (descriptionP) {
      descriptionP.innerHTML  = data.titulo || "";
    }

  } catch (error) {
    console.error("Erro ao carregar a lei:", error);
  }
}


if (lei) {
  carregarLei(lei);
}
</script>
            </main>
        </div>

        
    </div>
</body>
</html>